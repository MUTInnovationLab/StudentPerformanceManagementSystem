
<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title class ="t">HOD ANALYTICS</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
   <div class="analytics-container">
     <div class="charts-grid">
      <div class="chart-wrapper">
        <div class="chart-content">
          <div class="chart-container">
            <canvas id="attendanceChart"></canvas>
          </div>
        </div>
      </div>
      <div class="chart-wrapper">
        <div class="chart-content">
            <canvas id="marksChart"></canvas>
        </div>
      </div>
    </div>
  </div> 

  <ion-card>
    <ion-card-header>
      <ion-card-title class ="t">MODULE GRADE RANGE ANALYSIS</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <!-- Range Selector -->
      <ion-item>
        <ion-label>Select Grade Range</ion-label>
        <ion-select 
          [(ngModel)]="selectedRange" 
          (ionChange)="onRangeChange($event)"
          interface="action-sheet"
          placeholder="Select range"
        >
          <ion-select-option value="0-49">0-49%</ion-select-option>
          <ion-select-option value="50-59">50-59%</ion-select-option>
          <ion-select-option value="60-69">60-69%</ion-select-option>
          <ion-select-option value="70-79">70-79%</ion-select-option>
          <ion-select-option value="80-89">80-89%</ion-select-option>
          <ion-select-option value="90-100">90-100%</ion-select-option>
        </ion-select>
      </ion-item>

      <!-- Loading Spinner -->
      <div *ngIf="isLoading" class="ion-text-center ion-padding">
        <ion-spinner></ion-spinner>
        <p>Loading module data...</p>
      </div>

      <ion-item *ngIf="!isLoading && moduleDetailsData.length === 0" lines="none">
        <ion-label class="ion-text-center">
          No modules found in this range
        </ion-label>
      </ion-item>
   
      <ion-grid>
        <ion-row class="table">
          <ion-col size="2"><strong>Module Code</strong></ion-col>
          <ion-col  size="4"><strong>Module Name</strong></ion-col>
          <ion-col  size="3"><strong>Module Level</strong></ion-col>
          <ion-col  size="3"><strong>Action</strong></ion-col>
        </ion-row>
        <ng-container *ngFor="let module of moduleDetailsData; let i = index">
          <ion-row (click)="toggleRow(i)" button>
            <ion-col  size="2">{{ module.moduleCode }}</ion-col>
            <ion-col  size="4">{{ module.moduleName }}</ion-col>
            <ion-col  size="3">{{ module.moduleLevel }}</ion-col>
            <ion-col  size="3">
              <ion-button 
                fill="clear" 
                color="primary" 
                (click)="showFailingStudents(module)">
                <ion-icon name="warning-outline" slot="start" class="btn"></ion-icon>
                At Risk
              </ion-button>
            </ion-col>
            <ion-col>
              <ion-icon
                [name]="expandedRowIndex === i ? 'chevron-down' : 'chevron-forward'"
                slot="end">
              </ion-icon>
            </ion-col>
          </ion-row>
      
          <!-- Lecturer Details Row -->
          <ion-row *ngIf="expandedRowIndex === i" class="table lecturer-row">
            <ion-col colspan="4">
              <div *ngIf="module.lecturerDetails">
                <strong>Lecturer Name:</strong> {{ module.lecturerDetails.fullName }}<br>
                <strong> Lecturer Email:</strong> {{ module.lecturerDetails.email }}
              </div>
              <div *ngIf="!module.lecturerDetails">Loading lecturer details...</div>
            </ion-col>
          </ion-row>
        </ng-container>
      </ion-grid>
    </ion-card-content>
  </ion-card>
<ion-card>
  <ion-list>
    <ion-item-group>
      <ion-item-divider>
        <ion-label>
          Students at Academic Risk
          </ion-label>
        </ion-item-divider>
      </ion-item-group>
    
      <ion-list>
        <ion-item *ngFor="let student of failingStudentsDetails">
          <ion-avatar slot="start">
            <ion-icon name="person-outline" class="student-icon"></ion-icon>
          </ion-avatar>
          <ion-label>
            <h2>{{ student.name }} {{ student.surname }}</h2>
            <p>
              <ion-text color="medium">
                Student Number: {{ student.studentNumber }}
              </ion-text>
            </p>
            <p>
              <ion-text color="danger">
                Average: {{ student.average }}%
              </ion-text>
            </p>
            <p>
              <ion-text color="medium">
                Email: {{ student.email }}
              </ion-text>
            </p>
          </ion-label>
        </ion-item>
      </ion-list>
    </ion-list>
  </ion-card>
</ion-content>

